<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>JustSadSock’s Minigames</title>
    <meta name="theme-color" content="#0b0b0f" />
    <!-- лёгкий пиксельный favicon, чтобы не было 404 -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16'%3E%3Crect width='16' height='16' fill='%230b0b0f'/%3E%3Crect x='3' y='3' width='10' height='10' fill='%23c7d6ff'/%3E%3Crect x='5' y='5' width='6' height='6' fill='%234b5a8c'/%3E%3C/svg%3E">
    <!-- Пиксель-шрифт для ретро-вида -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
    <!-- Все эффекты — чистый код. Ни картинок, ни библиотек. -->
    <link rel="preload" href="./styles.css" as="style" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <!-- CRT слои (очень мягкие, без «кислоты») -->
    <canvas id="crt-canvas" aria-hidden="true"></canvas>
    <div id="scanlines" aria-hidden="true"></div>
    <div id="vignette" aria-hidden="true"></div>
    <div id="flicker" aria-hidden="true"></div>

    <!-- Вся UI-рамка автомата -->
    <div class="cabinet" role="application" aria-label="JustSadSock’s Minigames">
      <!-- Маркиза (ретро, мягкая) -->
      <header class="marquee">
        <!-- Пиксельный канвас подложка для шапки -->
        <canvas id="px-header" class="px-layer" aria-hidden="true"></canvas>
        <div class="marquee-inner">
          <div class="logo">
            <span class="logo-shadow">JustSadSock’s</span>
            <span class="logo-front">Minigames</span>
          </div>
          <div class="header-right">
            <button class="coin-btn" id="insertCoinBtn" title="Вставить монету (C)" aria-label="Insert coin">
              <span class="coin-led" id="coinLed"></span>
              INSERT COIN
            </button>
            <div class="account">
              <canvas id="avatar" width="32" height="32" class="avatar-canvas" aria-label="Аватар" data-px="true"></canvas>
              <div class="nick-block">
                <div class="nick" id="nickDisplay">@player</div>
                <button class="nick-edit" id="changeNickBtn" title="Изменить ник">EDIT</button>
              </div>
            </div>
            <button id="settingsBtn" class="settings-btn" title="Настройки" aria-label="Открыть настройки">
              <span class="gear"></span>
            </button>
            <button id="avatarBtn" class="settings-btn" title="Аватар" aria-label="Редактор аватара">
              <span class="gear"></span>
            </button>
          </div>
        </div>
      </header>

      <!-- Панель статуса -->
      <div class="statusbar" role="status" aria-live="polite">
        <!-- Пиксельная подложка -->
        <canvas id="px-status" class="px-layer" aria-hidden="true"></canvas>
        <div class="status-left">
          <span class="led led-green" id="ledReady"></span> READY
        </div>
        <div class="status-center">
          <span id="creditsLabel">CREDITS: <b id="credits">00</b></span>
        </div>
        <div class="status-right">
          <span class="small-phosphor" id="paletteName">PICO-8</span>
        </div>
      </div>

      <!-- Меню игр: строго по два в ряд, вертикальная прокрутка -->
      <main class="menu" id="menuRoot">
        <div id="gamesGrid" class="games-grid" role="list" aria-label="Список игр">
          <!-- Карточки генерируются скриптом -->
        </div>
      </main>

      <!-- Низ автомата: кнопки управления -->
      <footer class="controlbar">
        <!-- Пиксельная подложка -->
        <canvas id="px-footer" class="px-layer" aria-hidden="true"></canvas>
        <div class="control-left">
          <button class="px-btn" data-nav="up" title="Наверх (↑)">▲</button>
          <button class="px-btn" data-nav="down" title="Вниз (↓)">▼</button>
        </div>
        <div class="control-center">
          <button class="px-btn primary" id="startBtn" title="Старт (Enter)">START</button>
          <button class="px-btn" id="randomBtn" title="Случайная игра (R)">RND</button>
        </div>
        <div class="control-right">
          <button class="px-btn" id="muteBtn" title="Звук вкл/выкл (M)">SOUND</button>
          <button class="px-btn" id="scanBtn" title="Сканлайны вкл/выкл">SCAN</button>
        </div>
      </footer>
    </div>

    <!-- Оверлей игры: монтируем реальные модули из ./games/<slug>/module.js -->
    <div id="gameOverlay" class="game-overlay hidden" aria-hidden="true">
      <div class="game-bar">
        <button id="btnBackToMenu" class="px-btn" title="Назад в меню (Esc)">MENU</button>
        <div class="game-title" id="gameTitle" data-px="true">—</div>
      </div>
      <div id="gameMount" class="game-mount" role="region" aria-label="Игровое поле">
        <div id="gameCanvasWrap" class="game-viewport"></div>
      </div>
    </div>

    <!-- Модалка настроек -->
    <dialog id="settingsModal" class="px-modal">
      <form method="dialog" class="px-modal-inner">
        <h2>НАСТРОЙКИ</h2>
        <div class="grid2">
          <label class="toggle">
            <input type="checkbox" id="soundToggle" checked />
            <span>ЗВУК</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="bloomToggle" checked />
            <span>БЛЮМ</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="scanToggle" checked />
            <span>СКАНЛАЙНЫ</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="noiseToggle" checked />
            <span>ШУМ</span>
          </label>
          <label class="range">
            <span>ГРОМКОСТЬ</span>
            <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="0.35" />
          </label>
          <label class="select">
            <span>ПАЛИТРА</span>
            <select id="paletteSelect">
              <option value="pico8" selected>PICO-8</option>
              <option value="c64">Commodore 64</option>
              <option value="gb">Game Boy</option>
              <option value="nes">NES</option>
            </select>
          </label>
        </div>
        <div class="modal-actions">
          <button class="px-btn" value="cancel">ОТМЕНА</button>
          <button class="px-btn primary" value="ok">OK</button>
        </div>
      </form>
    </dialog>

    <!-- Модалка аватара (пиксель-редактор) -->
    <dialog id="avatarModal" class="px-modal">
      <form method="dialog" class="px-modal-inner">
        <h2>АВАТАР</h2>
        <div class="avatar-grid">
          <canvas id="avatarEditor" width="128" height="128" class="avatar-editor" aria-label="Редактор пиксель-аватара" data-px="true"></canvas>
          <div class="avatar-controls">
            <label class="select">
              <span>КОЖА</span>
              <select id="skinSelect"></select>
            </label>
            <label class="select">
              <span>ВОЛОСЫ</span>
              <select id="hairSelect"></select>
            </label>
            <label class="select">
              <span>ЦВЕТ ВОЛОС</span>
              <select id="hairColorSelect"></select>
            </label>
            <label class="select">
              <span>ГЛАЗА</span>
              <select id="eyesSelect"></select>
            </label>
            <label class="select">
              <span>РОТ</span>
              <select id="mouthSelect"></select>
            </label>
          </div>
        </div>
        <div class="modal-actions">
          <button class="px-btn" value="cancel">ОТМЕНА</button>
          <button class="px-btn primary" value="save">СОХРАНИТЬ</button>
        </div>
      </form>
    </dialog>

    <!-- HUD-подсказки -->
    <div class="hud" id="hud"></div>

    <script src="./script.js"></script>
  </body>
</html>
