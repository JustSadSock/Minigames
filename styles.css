/* ======== Глобальные переменные и палитры ======== */
:root {
  --px: 4px;                 /* базовая пиксельная сетка */
  --bg: #0b0b0f;
  --ink: #e7f2ff;
  --dim: #9bb0c0;
  --accent: #ff2166;
  --accent2: #14ffd2;
  --accent3: #ffd319;
  --panel: #11141a;
  --panel2: #0e1016;
  --scan-alpha: 0.12;
  --bloom: 0.35;
  --noise: 0.08;
  --shadow: rgba(0, 0, 0, .7);
}

/* Пиксельное сглаживание */
html, body, canvas, button, select, input {
  image-rendering: pixelated;
  -ms-interpolation-mode: nearest-neighbor;
  text-rendering: optimizeSpeed;
}

html, body {
  margin: 0;
  height: 100%;
  background: var(--bg);
  color: var(--ink);
  overflow: hidden;
}

/* ======== CRT-слои ======== */
#crt-canvas, #scanlines, #vignette, #flicker {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
}
#crt-canvas { z-index: 1; }
#scanlines {
  z-index: 2;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(0,0,0,var(--scan-alpha)) 0,
      rgba(0,0,0,var(--scan-alpha)) 1px,
      transparent 2px,
      transparent 3px
    );
  mix-blend-mode: multiply;
}
#vignette {
  z-index: 3;
  background:
    radial-gradient(ellipse at center, rgba(0,0,0,0) 55%, rgba(0,0,0,.35) 85%, rgba(0,0,0,.7) 100%);
}
#flicker {
  z-index: 4;
  animation: flicker 120ms infinite steps(2, jump-both);
  background: rgba(255,255,255,0.015);
  mix-blend-mode: screen;
}
@keyframes flicker {
  0% { opacity: .4; }
  50% { opacity: .6; }
  100% { opacity: .4; }
}

/* ======== Корпус автомата ======== */
.cabinet {
  position: relative;
  z-index: 5;
  height: 100dvh;
  display: grid;
  grid-template-rows: auto auto 1fr auto;
  gap: calc(var(--px) * 2);
  padding: calc(var(--px) * 2);
  box-sizing: border-box;
}

/* ======== Маркиза ======== */
.marquee {
  background:
    linear-gradient(180deg, #1b2030, #0a0d14),
    repeating-linear-gradient(45deg, rgba(255,255,255,.02) 0 8px, transparent 8px 16px);
  border: calc(var(--px) * 0.75) solid #06070b;
  box-shadow:
    0 0 calc(var(--px) * 6) #0ff5,
    inset 0 0 calc(var(--px) * 4) #09f3;
}
.marquee-inner {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  padding: calc(var(--px) * 2);
}
.logo {
  position: relative;
  font-weight: 900;
  letter-spacing: calc(var(--px) * 0.5);
  filter: drop-shadow(0 0 calc(var(--px)*2) #14ffd2aa);
}
.logo span {
  display: block;
  font-size: clamp(14px, 4.2vw, 36px);
  line-height: 1;
  font-family: monospace;
}
.logo-front {
  color: var(--accent2);
  text-shadow:
    calc(var(--px)*0.5) 0 #f0f,
    calc(var(--px)*-0.5) 0 #0ff;
  transform: translateY(-1px);
}
.logo-shadow {
  color: #022b2b;
  filter: blur(calc(var(--px)*0.25));
}
.header-right {
  display: grid;
  grid-auto-flow: column;
  gap: calc(var(--px) * 2);
  align-items: center;
}
.coin-btn {
  font-family: monospace;
  font-size: 12px;
  padding: calc(var(--px)*1.5) calc(var(--px)*2);
  background: #0a0;
  border: calc(var(--px)*0.5) solid #040;
  color: #fff;
  box-shadow: 0 0 calc(var(--px)*2) #0f5;
  cursor: pointer;
}
.coin-btn:active { transform: translateY(1px); }
.coin-led {
  width: calc(var(--px)*2);
  height: calc(var(--px)*2);
  display: inline-block;
  background: radial-gradient(circle at 30% 30%, #6f6, #070);
  margin-right: calc(var(--px));
  vertical-align: -2px;
  box-shadow: 0 0 calc(var(--px)*2) #3f7;
}
.account {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: calc(var(--px)*1);
  align-items: center;
  background: #0a0d14;
  border: calc(var(--px)*0.5) solid #04070b;
  padding: calc(var(--px)*1);
}
.avatar-canvas {
  width: 32px; height: 32px;
  border: calc(var(--px)*0.5) solid #263;
  background: #022;
}
.nick-block { display: grid; gap: calc(var(--px)*0.5); }
.nick { font-family: monospace; font-size: 12px; color: var(--accent2); }
.nick-edit {
  justify-self: start;
  font-size: 10px;
  background: #222;
  color: #fff;
  border: calc(var(--px)*0.5) solid #333;
  padding: calc(var(--px)*0.5) calc(var(--px)*1);
  cursor: pointer;
}
.settings-btn {
  width: 36px; height: 36px;
  background: #1b1f2a;
  border: calc(var(--px)*0.5) solid #0a0d14;
  box-shadow: inset 0 0 calc(var(--px)*2) #48f3;
  position: relative;
  cursor: pointer;
}
.settings-btn .gear, .settings-btn .gear::before, .settings-btn .gear::after {
  position: absolute; inset: 0; margin: auto;
  width: 18px; height: 18px; content: "";
  border: calc(var(--px)*0.5) solid var(--accent2);
  border-radius: 2px;
  transform: rotate(45deg);
  animation: gearspin 8s linear infinite;
}
.settings-btn .gear::before {
  width: 10px; height: 10px; border-color: var(--accent);
  animation-direction: reverse;
}
.settings-btn .gear::after {
  width: 4px; height: 4px; border-color: var(--accent3);
  animation-duration: 3s;
}
@keyframes gearspin { to { transform: rotate(405deg); } }

/* ======== Statusbar ======== */
.statusbar {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: calc(var(--px)*2);
  padding: calc(var(--px)*1.5) calc(var(--px)*2);
  background:
    linear-gradient(180deg, #0f121a, #080a10);
  border: calc(var(--px)*0.5) solid #070a0f;
}
.status-left, .status-center, .status-right {
  font-family: monospace;
  font-size: 12px;
  color: var(--dim);
}
.status-center { text-align: center; }
.status-right { text-align: right; }
.led {
  display: inline-block; width: calc(var(--px)*2); height: calc(var(--px)*2);
  margin-right: calc(var(--px)*1); vertical-align: -2px;
  background: #030;
  box-shadow: 0 0 calc(var(--px)*2) #0f73;
}
.led-green { background: radial-gradient(circle at 30% 30%, #6f6, #070); }
.small-phosphor { color: var(--accent3); }

/* ======== Меню игр ======== */
.menu {
  border: calc(var(--px)*0.5) solid #0a0d14;
  background: repeating-linear-gradient(
    0deg, #0b0f14, #0b0f14 8px, #0a0d12 8px, #0a0d12 16px
  );
  overflow: hidden;
  position: relative;
}
.games-grid {
  height: 100%;
  overflow-y: auto;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: calc(var(--px)*2);
  padding: calc(var(--px)*2);
  scroll-behavior: smooth;
}
.games-grid::-webkit-scrollbar { width: 10px; }
.games-grid::-webkit-scrollbar-track { background: #0b0f14; }
.games-grid::-webkit-scrollbar-thumb {
  background: linear-gradient(#263042, #111726);
  border: 2px solid #0b0f14;
}

.card {
  position: relative;
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: calc(var(--px)*1);
  background: #0d1320;
  border: calc(var(--px)*0.75) solid #000;
  box-shadow:
    inset 0 0 0 calc(var(--px)*0.5) #1a2334,
    0 0 calc(var(--px)*3) rgba(0,0,0,.6);
  padding: calc(var(--px)*2);
  min-height: 180px;
  transform: translateZ(0);
}
.card:focus-within, .card[data-focused="true"] {
  outline: calc(var(--px)*0.5) solid var(--accent2);
  box-shadow:
    inset 0 0 0 calc(var(--px)*0.5) #1a2334,
    0 0 calc(var(--px)*6) #0ff6;
}
.card-title {
  font-family: monospace;
  letter-spacing: calc(var(--px)*0.25);
  font-size: 12px;
  color: var(--accent2);
}
.card-canvas {
  width: 100%; aspect-ratio: 4/3;
  background: #02060a;
  border: calc(var(--px)*0.5) solid #121826;
}
.card-footer {
  display: grid;
  grid-auto-flow: column;
  justify-content: space-between;
  align-items: center;
}
.card .start {
  font-family: monospace; font-size: 12px;
  padding: calc(var(--px)*1) calc(var(--px)*2);
  background: #0a1d2f;
  color: #c8f7ff;
  border: calc(var(--px)*0.5) solid #0c2d4f;
  cursor: pointer;
  box-shadow: 0 0 calc(var(--px)*2) #29f5;
}
.hiscore {
  font-size: 11px;
  color: var(--accent3);
  text-shadow: 0 0 calc(var(--px)*1) #fc0;
}

/* ======== Низовая панель ======== */
.controlbar {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: calc(var(--px)*2);
  padding: calc(var(--px)*1.5) calc(var(--px)*2);
  background: linear-gradient(180deg, #080a10, #05070a);
  border: calc(var(--px)*0.5) solid #060910;
}
.control-left, .control-center, .control-right {
  display: grid; grid-auto-flow: column; gap: calc(var(--px)*1.5);
}
.control-center { justify-content: center; }
.control-right { justify-content: end; }
.px-btn {
  font-family: monospace; font-size: 12px; color: var(--ink);
  background: #151a24; border: calc(var(--px)*0.5) solid #0a0d14;
  padding: calc(var(--px)*1) calc(var(--px)*2); cursor: pointer;
  box-shadow: inset 0 0 calc(var(--px)*2) #29f2;
}
.px-btn.primary {
  background: #07304a; border-color: #084261;
  box-shadow: inset 0 0 calc(var(--px)*3) #4bf7;
}
.px-btn:active { transform: translateY(1px); }

/* ======== Модалка ======== */
.px-modal {
  border: none; background: transparent; padding: 0;
}
.px-modal::backdrop { background: rgba(0,0,0,.6); }
.px-modal-inner {
  width: min(560px, 96vw);
  background: #0c1019;
  border: calc(var(--px)*0.75) solid #000;
  box-shadow:
    inset 0 0 0 calc(var(--px)*0.5) #1a2334,
    0 0 calc(var(--px)*6) rgba(0,0,0,.7);
  padding: calc(var(--px)*3);
  color: var(--ink);
}
.px-modal-inner h2 {
  margin: 0 0 calc(var(--px)*2) 0;
  font-family: monospace;
  color: var(--accent2);
}
.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: calc(var(--px)*2); }
.toggle, .range, .select { display: grid; gap: calc(var(--px)); font-family: monospace; }
.toggle input[type="checkbox"] { width: 18px; height: 18px; }
.range input[type="range"] { width: 100%; }
.select select { width: 100%; background: #131a26; color: var(--ink); border: 1px solid #223; }
.modal-actions { display: grid; grid-auto-flow: column; gap: calc(var(--px)*2); justify-content: end; margin-top: calc(var(--px)*2); }

/* ======== HUD ======== */
.hud {
  position: fixed; z-index: 9; inset: auto 0 calc(var(--px)*2) 0;
  display: grid; place-items: center; pointer-events: none;
  font-family: monospace; font-size: 12px; color: var(--accent3);
  text-shadow: 0 0 calc(var(--px)*1) #fc0, 0 0 calc(var(--px)*2) #960;
}

/* ======== Палитры (меняются переменные) ======== */
.palette-pico8 { --bg:#1d2b53; --panel:#0b0b0f; --panel2:#11141a; --accent:#ff004d; --accent2:#00e756; --accent3:#fff024; }
.palette-c64   { --bg:#0b0b0f; --panel:#1d1734; --panel2:#100c24; --accent:#6a5cff; --accent2:#5fff9e; --accent3:#ffd37e; }
.palette-gb    { --bg:#0a1a0a; --panel:#0d240d; --panel2:#091a09; --accent:#9bbc0f; --accent2:#8bac0f; --accent3:#306230; }
.palette-nes   { --bg:#0b0b0f; --panel:#16161d; --panel2:#0e0e14; --accent:#ff3e3e; --accent2:#3eff3e; --accent3:#ffd93e; }

/* ======== Мобильная адаптация (сохраняем 2 колонки!) ======== */
@media (max-width: 480px) {
  .games-grid { gap: calc(var(--px)*1.5); padding: calc(var(--px)*1.5); }
  .card { min-height: 150px; padding: calc(var(--px)*1.5); }
  .logo span { font-size: clamp(12px, 6vw, 24px); }
  .status-left, .status-center, .status-right { font-size: 11px; }
  .px-btn { font-size: 11px; padding: calc(var(--px)*0.75) calc(var(--px)*1.5); }
}
